---
layout:    post
title:    "Go æ¯æ—¥ä¸€åº“ä¹‹ jennifer"
subtitle: 	"æ¯å¤©å­¦ä¹ ä¸€ä¸ª Go åº“"
date:		2020-03-14T12:32:23
author:		"darjun"
image:	"img/post-bg-2015.jpg"
tags:
    - Go æ¯æ—¥ä¸€åº“
URL: "2020/03/14/godailylib/jennifer"
categories: [
	"Go"
]
---

## ç®€ä»‹

ä»Šå¤©æˆ‘ä»¬ä»‹ç»ä¸€ä¸ª Go ä»£ç ç”Ÿæˆåº“[`jennifer`](https://github.com/dave/jennifer)ã€‚`jennifer`æ”¯æŒæ‰€æœ‰çš„ Go è¯­æ³•å’Œç‰¹æ€§ï¼Œå¯ä»¥ç”¨å®ƒæ¥ç”Ÿæˆä»»ä½• Go è¯­è¨€ä»£ç ã€‚

æ„Ÿè°¢[kiyonlin](https://github.com/kiyonlin)çš„æ¨èï¼

## å¿«é€Ÿä½¿ç”¨

å…ˆå®‰è£…ï¼š

```golang
$ go get github.com/dave/jennifer
```

ä»Šå¤©æˆ‘ä»¬æ¢ä¸ªæ€è·¯æ¥ä»‹ç»`jennifer`è¿™ä¸ªåº“ã€‚æ—¢ç„¶ï¼Œå®ƒæ˜¯ç”¨æ¥ç”Ÿæˆ Go è¯­è¨€ä»£ç çš„ã€‚æˆ‘ä»¬å°±å…ˆå†™å‡ºæƒ³è¦ç”Ÿæˆçš„ç¨‹åºï¼Œç„¶åçœ‹çœ‹å¦‚ä½•ä½¿ç”¨`jennifer`æ¥ç”Ÿæˆã€‚å…ˆä»ç¬¬ä¸€ä¸ªç¨‹åº`Hello World`å¼€å§‹ï¼š

```golang
package main

import "fmt"

func main() {
  fmt.Println("Hello World")
}
```

æˆ‘ä»¬å¦‚ä½•ç”¨`jennifer`æ¥ç”Ÿæˆä¸Šé¢çš„ç¨‹åºä»£ç å‘¢ï¼š

```golang
package main

import (
  "fmt"

  . "github.com/dave/jennifer/jen"
)

func main() {
  f := NewFile("main")
  f.Func().Id("main").Params().Block(
    Qual("fmt", "Println").Call(Lit("Hello, world")),
  )
  fmt.Printf("%#v", f)
}
```

Go ç¨‹åºçš„åŸºæœ¬ç»„ç»‡å•ä½æ˜¯æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å±äºä¸€ä¸ªåŒ…ï¼Œå¯æ‰§è¡Œç¨‹åºå¿…é¡»æœ‰ä¸€ä¸ª`main`åŒ…ï¼Œ`main`åŒ…ä¸­åˆå¿…é¡»æœ‰ä¸€ä¸ª`main`å‡½æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨`jennifer`ç”Ÿæˆä»£ç çš„å¤§ä½“æ­¥éª¤ä¹Ÿæ˜¯å·®ä¸å¤šçš„ï¼š

* å…ˆä½¿ç”¨`NewFile`å®šä¹‰ä¸€ä¸ªåŒ…æ–‡ä»¶å¯¹è±¡ï¼Œå‚æ•°å³ä¸ºåŒ…åï¼›
* ç„¶åè°ƒç”¨è¿™ä¸ªåŒ…æ–‡ä»¶å¯¹è±¡çš„`Func()`å®šä¹‰å‡½æ•°ï¼›
* å‡½æ•°å¯ä»¥ä½¿ç”¨`Params()`å®šä¹‰å‚æ•°ï¼Œé€šè¿‡`Block()`å®šä¹‰å‡½æ•°ä½“ï¼›
* å‡½æ•°ä½“æ˜¯ç”±ä¸€æ¡ä¸€æ¡è¯­å¥ç»„æˆçš„ã€‚è¯­å¥çš„å†…å®¹æ¯”è¾ƒå¤šæ ·ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚

ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ª`main`åŒ…æ–‡ä»¶å¯¹è±¡ã€‚ç„¶åè°ƒç”¨å…¶`Func()`å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œ`Id()`ä¸ºå‡½æ•°å‘½åä¸º`main`ï¼Œ`Params()`ä¼ å…¥ç©ºå‚æ•°ï¼Œ`Block()`ä¸­ä¼ å…¥å‡½æ•°ä½“ã€‚å‡½æ•°ä½“ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`Qual("fmt", "Println")`æ¥è¡¨ç¤ºå¼•ç”¨`fmt.Println`è¿™ä¸ªå‡½æ•°ã€‚ä½¿ç”¨`Call()`è¡¨ç¤ºå‡½æ•°è°ƒç”¨ï¼Œç„¶å`Lit()`å°†å­—ç¬¦ä¸²**"Hello World"**å­—é¢é‡ä½œä¸ºå‚æ•°ä¼ ç»™`fmt.Println()`ã€‚

`Qual`å‡½æ•°è¿™é‡Œéœ€è¦ç‰¹æ„è®²ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ˜¾ç¤ºå¯¼å…¥åŒ…ï¼Œ`Qual`å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯åŒ…è·¯å¾„ã€‚å¦‚æœæ˜¯æ ‡å‡†åº“ï¼Œç›´æ¥å°±æ˜¯åŒ…åï¼Œä¾‹å¦‚è¿™é‡Œçš„`fmt`ã€‚å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œéœ€è¦åŠ ä¸ŠåŒ…è·¯å¾„é™å®šï¼Œä¾‹å¦‚`github.com/spf13/viper`ã€‚è¿™ä¹Ÿæ˜¯`Qual`åå­—çš„ç”±æ¥ï¼ˆ`Qualified`ï¼Œæƒ³åˆ°**full qualified class name**äº†å—ğŸ˜„ï¼‰ã€‚`jennifer`åœ¨ç”Ÿæˆç¨‹åºæ—¶ä¼šæ±‡æ€»æ‰€æœ‰ç”¨åˆ°çš„åŒ…ï¼Œç»Ÿä¸€å¯¼å…¥ã€‚

è¿è¡Œç¨‹åºï¼Œæˆ‘ä»¬æœ€ç»ˆè¾“å‡ºäº†ä¸€å¼€å§‹æƒ³è¦ç”Ÿæˆçš„ç¨‹åºä»£ç ï¼

å®é™…ä¸Šï¼Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•éƒ½æœ‰ç›¸é€šä¹‹å¤„ã€‚Go è¯­è¨€çš„è¯­æ³•æ¯”è¾ƒç®€å•ï¼š

* åŸºæœ¬çš„æ¦‚å¿µï¼šå˜é‡ã€å‡½æ•°ã€ç»“æ„ç­‰ï¼Œå®ƒä»¬éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œåˆç§°ä¸ºæ ‡è¯†ç¬¦ã€‚ç›´æ¥å†™åœ¨ç¨‹åºä¸­çš„æ•°å­—ã€å­—ç¬¦ä¸²ç­‰è¢«ç§°ä¸ºå­—é¢é‡ï¼Œå¦‚ä¸Šé¢çš„**"Hello World"**ï¼›
* æµç¨‹æ§åˆ¶ï¼šæ¡ä»¶ï¼ˆ`if`ï¼‰ã€å¾ªç¯ï¼ˆ`for`ï¼‰ï¼›
* å‡½æ•°å’Œæ–¹æ³•ï¼›
* å¹¶å‘ç›¸å…³ï¼šgoroutine å’Œ channelã€‚

æœ‰å‡ ç‚¹æ³¨æ„ï¼š

* æˆ‘ä»¬åœ¨å¯¼å…¥`jennifer`åŒ…çš„æ—¶å€™åœ¨åŒ…è·¯å¾„å‰é¢åŠ äº†ä¸€ä¸ª`.`ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼å¯¼å…¥ï¼Œåœ¨åé¢ä½¿ç”¨è¯¥åº“çš„ç›¸å…³å‡½æ•°å’Œå˜é‡æ—¶ä¸éœ€è¦æ·»åŠ `jen.`é™å®šã€‚ä¸€èˆ¬æ˜¯ä¸å»ºè®®è¿™æ ·åšçš„ã€‚ä½†æ˜¯`jennifer`çš„å‡½æ•°æ¯”è¾ƒå¤šï¼Œå¦‚æœä¸è¿™æ ·çš„è¯ï¼Œæ¯æ¬¡éƒ½éœ€è¦åŠ ä¸Š`jen.`æ¯”è¾ƒç¹çã€‚
* `jennifer`çš„å¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯å¯ä»¥**é“¾å¼è°ƒç”¨**çš„ï¼Œæ¯ä¸ªæ–¹æ³•å¤„ç†å®Œæˆä¹‹åéƒ½ä¼šè¿”å›å½“å‰å¯¹è±¡ï¼Œä¾¿äºä»£ç çš„ç¼–å†™ã€‚

ä¸‹é¢æˆ‘ä»¬ä»ä¸Šé¢å‡ ä¸ªéƒ¨åˆ†ä¾æ¬¡æ¥ä»‹ç»ã€‚

## å˜é‡å®šä¹‰ä¸è¿ç®—

å…¶å®ä»è¯­æ³•å±‚é¢æ¥è®²ï¼Œå˜é‡å°±æ˜¯æ ‡è¯†ç¬¦ + ç±»å‹ã€‚ä¸Šé¢æˆ‘ä»¬ç›´æ¥ä½¿ç”¨äº†å­—é¢é‡ï¼Œè¿™æ¬¡æˆ‘ä»¬æƒ³å…ˆå®šä¹‰ä¸€ä¸ªå˜é‡å­˜å‚¨æ¬¢è¿ä¿¡æ¯ï¼š

```golang
func main() {
  var greeting = "Hello World"
  fmt.Println(greeting)
}
```

å˜é‡å®šä¹‰çš„æ–¹å¼æœ‰å¥½å‡ ç§ï¼Œ`jennifer`å¯ä»¥æ¯”è¾ƒç›´è§‚çš„è¡¨è¾¾æˆ‘ä»¬çš„æ„å›¾ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢çš„`var greeting = "Hello World"`ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¯ä»¥é€å­—ç¿»è¯‘ï¼š

* `var`æ˜¯å˜é‡å®šä¹‰ï¼Œ`jennifer`ä¸­æœ‰å¯¹åº”çš„å‡½æ•°`Var()`ï¼›
* `greeting`å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨`Id()`æ¥å®šä¹‰ï¼›
* `=`æ˜¯èµ‹å€¼æ“ä½œç¬¦ï¼Œæˆ‘ä»¬ä½¿ç”¨`Op("=")`æ¥è¡¨ç¤ºï¼›
* **"Hello World"**æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ï¼Œæœ€å¼€å§‹çš„ä¾‹å­ä¸­å·²ç»ä»‹ç»è¿‡äº†ï¼Œå¯ä»¥ä½¿ç”¨`Lit()`å®šä¹‰ã€‚

æ‰€ä»¥ï¼Œè¿™æ¡è¯­å¥ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š

```golang
Var().Id("greeting").Op("=").Lit("Hello World")
```

åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¯•è¯•å¦ä¸€ç§å˜é‡å®šä¹‰æ–¹å¼`greeting := "Hello World"`ï¼š

```golang
Id("greeting").Op(":=").Lit("Hello World")
```

æ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚æ•´ä¸ªç¨‹åºå¦‚ä¸‹ï¼ˆçœç•¥åŒ…åå’Œå¯¼å…¥ï¼Œä¸‹åŒï¼‰ï¼š

```golang
func main() {
  f := NewFile("main")
  f.Func().Id("main").Params().Block(
    // Var().Id("greeting").Op("=").Lit("Hello World"),
    Id("greeting").Op(":=").Lit("Hello World"),
    Qual("fmt", "Println").Call(Id("greeting")),
  )
  fmt.Printf("%#v\n", f)
}
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨å˜é‡åšä¸€äº›è¿ç®—ã€‚å‡è®¾ï¼Œæˆ‘ä»¬è¦ç”Ÿæˆä¸‹é¢è¿™æ®µç¨‹åºï¼š

```golang
package main

import "fmt"

func main() {
  var a = 10
  var b = 2
  fmt.Printf("%d + %d = %d\n", a, b, a+b)
  fmt.Printf("%d + %d = %d\n", a, b, a-b)
  fmt.Printf("%d + %d = %d\n", a, b, a*b)
  fmt.Printf("%d + %d = %d\n", a, b, a/b)
}
```

å˜é‡å®šä¹‰è¿™é‡Œä¸å†èµ˜è¿°äº†ï¼Œæ–¹æ³•å’Œå‡½æ•°è°ƒç”¨å®é™…ä¸Š[å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)éƒ¨åˆ†ä¹Ÿä»‹ç»è¿‡ã€‚é¦–å…ˆç”¨`Qual("fmt", "Printf")`è¡¨ç¤ºå–åŒ…`fmt`ä¸­çš„`Printf`å‡½æ•°è¿™ä¸€æ¦‚å¿µã€‚ç„¶åä½¿ç”¨`Call()`è¡¨ç¤ºå‡½æ•°è°ƒç”¨ï¼Œå‚æ•°ç¬¬ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²å­—é¢é‡ï¼Œç”¨`Lit()`è¡¨ç¤ºã€‚ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªéƒ½æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œç”¨`Id("a")`å’Œ`Id("b")`å³å¯è¡¨ç¤ºã€‚æœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸¤ä¸ªæ ‡è¯†ç¬¦ä¹‹é—´çš„è¿ç®—ï¼Œè¿ç®—ç”¨`Op()`è¡¨ç¤ºï¼Œæ‰€ä»¥æœ€ç»ˆå°±æ˜¯ç”Ÿæˆç¨‹åºï¼š

```golang
func main() {
  f := NewFile("main")
  f.Func().Id("main").Params().Block(
    Var().Id("a").Op("=").Lit(10),
    Var().Id("b").Op("=").Lit(2),
    Qual("fmt", "Printf").Call(Lit("%d + %d = %d\n"), Id("a"), Id("b"), Id("a").Op("+").Id("b")),
    Qual("fmt", "Printf").Call(Lit("%d + %d = %d\n"), Id("a"), Id("b"), Id("a").Op("-").Id("b")),
    Qual("fmt", "Printf").Call(Lit("%d + %d = %d\n"), Id("a"), Id("b"), Id("a").Op("*").Id("b")),
    Qual("fmt", "Printf").Call(Lit("%d + %d = %d\n"), Id("a"), Id("b"), Id("a").Op("/").Id("b")),
  )
  fmt.Printf("%#v\n", f)
}
```

é€»è¾‘è¿ç®—æ˜¯ç±»ä¼¼çš„ã€‚

## æ¡ä»¶å’Œå¾ªç¯

å‡è®¾æˆ‘ä»¬è¦ç”Ÿæˆä¸‹é¢çš„ç¨‹åºï¼š

```golang
func main() {
  score := 70

  if score >= 90 {
    fmt.Println("ä¼˜ç§€")
  } else if score >= 80 {
    fmt.Println("è‰¯å¥½")
  } else if score >= 60 {
    fmt.Println("åŠæ ¼")
  } else {
    fmt.Println("ä¸åŠæ ¼")
  }
}
```

ä¾ç„¶é‡‡å–æˆ‘ä»¬çš„**é€å­—ç¿»è¯‘**å¤§æ³•ï¼š

* `if`å…³é”®å­—ç”¨`If()`æ¥è¡¨ç¤ºï¼Œæ¡ä»¶è¯­å¥æ˜¯åŸºæœ¬çš„æ ‡è¯†ç¬¦å’Œå¸¸é‡æ“ä½œã€‚æ¡ä»¶è¯­å¥å—ä¸å‡½æ•°ä½“ä¸€æ ·ï¼Œéƒ½ä½¿ç”¨`Block()`ï¼›
* `else`å…³é”®å­—ç”¨`Else()`æ¥è¡¨ç¤ºï¼Œ`else if`å°±æ˜¯`Else()`åé¢å†è°ƒç”¨`If()`å³å¯ã€‚

å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š

```golang
func main() {
  f := NewFile("main")

  f.Func().Id("main").Params().Block(
    Id("score").Op(":=").Lit(70),

    If(Id("score").Op(">=").Lit(90)).Block(
      Qual("fmt", "Println").Call(Lit("ä¼˜ç§€")),
    ).Else().If(Id("score").Op(">=").Lit(80)).Block(
      Qual("fmt", "Println").Call(Lit("è‰¯å¥½")),
    ).Else().If(Id("score").Op(">=").Lit(60)).Block(
      Qual("fmt", "Println").Call(Lit("åŠæ ¼")),
    ).Else().Block(
      Qual("fmt", "Println").Call(Lit("ä¸åŠæ ¼")),
    ),
  )

  fmt.Printf("%#v\n", f)
}
```

å¯¹äº`for`å¾ªç¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå¦‚æœæˆ‘ä»¬è¦ç”Ÿæˆä¸‹é¢çš„ç¨‹åºï¼š

```golang
package main

import "fmt"

func main() {
  var sum int
  for i := 1; i <= 100; i++ {
    sum += i
  }

  fmt.Println(sum)
}
```

æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸‹é¢çš„ç¨‹åºï¼š

```golang
func main() {
  f := NewFile("main")

  f.Func().Id("main").Params().Block(
    Var().Id("sum").Int(),

    For(
      Id("i").Op(":=").Lit(0),
      Id("i").Op("<=").Lit(100),
      Id("i").Op("++"),
    ).Block(
      Id("sum").Op("+=").Id("i"),
    ),

    Qual("fmt", "Println").Call(Id("sum")),
  )

  fmt.Printf("%#v\n", f)
}
```

`For()`é‡Œé¢çš„ 3 æ¡è¯­å¥å¯¹åº”å®é™…`for`è¯­å¥ä¸­çš„ 3 ä¸ªéƒ¨åˆ†ã€‚

## å‡½æ•°

å‡½æ•°æ˜¯æ¯ä¸ªç¼–ç¨‹è¯­è¨€çš„å¿…è¦å…ƒç´ ã€‚å‡½æ•°çš„æ ¸å¿ƒè¦ç´ æ˜¯åå­—ï¼ˆæ ‡è¯†ç¬¦ï¼‰ã€å‚æ•°åˆ—è¡¨ã€è¿”å›å€¼ï¼Œæœ€å…³é”®çš„å°±æ˜¯å‡½æ•°ä½“ã€‚æˆ‘ä»¬ä¹‹å‰ç¼–å†™`main`å‡½æ•°çš„æ—¶å€™å¤§æ¦‚ä»‹ç»è¿‡ã€‚å‡è®¾æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªè®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œçš„å‡½æ•°ï¼š

```golang
func add(a, b int) int {
  return a + b
}
```

* å‡½æ•°æˆ‘ä»¬ä½¿ç”¨`Func()`è¡¨ç¤ºï¼Œå‚æ•°ç”¨`Params()`è¡¨ç¤ºï¼Œè¿”å›å€¼ä½¿ç”¨`Int()`è¡¨ç¤ºï¼›
* å‡½æ•°ä½“ç”¨`Block()`ï¼›
* `return`è¯­å¥ä½¿ç”¨`Return()`å‡½æ•°è¡¨ç¤ºï¼Œå…¶ä»–éƒ½æ˜¯ä¸€æ ·çš„ã€‚

çœ‹ä¸‹é¢çš„å®Œæ•´ä»£ç ï¼š

```golang
func main() {
  f := NewFile("main")

  f.Func().Id("add").Params(Id("a"), Id("b").Int()).Int().Block(
    Return(Id("a").Op("+").Id("b")),
  )

  f.Func().Id("main").Params().Block(
    Id("a").Op(":=").Lit(1),
    Id("b").Op(":=").Lit(2),
    Qual("fmt", "Println").Call(Id("add").Call(Id("a"), Id("b"))),
  )

  fmt.Printf("%#v\n", f)
}
```

**ä¸€å®šè¦æ³¨æ„ï¼Œå³ä½¿æ²¡æœ‰å‚æ•°ï¼Œ`Params()`ä¹Ÿä¸€å®šè¦è°ƒç”¨ï¼Œå¦åˆ™ç”Ÿæˆçš„ä»£ç æœ‰è¯­æ³•é”™è¯¯**ã€‚

## ç»“æ„å’Œæ–¹æ³•

ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ç»“æ„å’Œæ–¹æ³•å¦‚ä½•ç”Ÿæˆï¼Œå‡è®¾æˆ‘ä»¬æƒ³ç”Ÿæˆä¸‹é¢çš„ç¨‹åºï¼š

```golang
package main

import "fmt"

type User struct {
  Name string
  Age  int
}

func (u *User) Greeting() {
  fmt.Printf("Hello %s", u.Name)
}
func main() {
  u := User{Name: "dj", Age: 18}
  u.Greeting()
}
```

éœ€è¦ç”¨åˆ°çš„æ–°å‡½æ•°ï¼š

* ç»“æ„ä½“æ˜¯ä¸€ä¸ªç±»å‹ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°ç±»å‹å®šä¹‰å‡½æ•°`Type()`ï¼Œç„¶åç»“æ„ä½“çš„å­—æ®µåœ¨`Struct()`å†…é€šè¿‡`Id()`+ç±»å‹å®šä¹‰ï¼›
* æ–¹æ³•å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåªä¸è¿‡å¤šäº†ä¸€ä¸ªæ¥æ”¶å™¨ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨`Func()`å®šä¹‰ï¼Œæ¥æ”¶è€…ä¹Ÿå¯ä»¥ç”¨å®šä¹‰å‚æ•°çš„`Params()`å‡½æ•°æ¥æŒ‡å®šï¼Œå…¶å®ƒä¸å‡½æ•°æ²¡ä»€ä¹ˆä¸åŒï¼›
* ç„¶åç»“æ„ä½“åˆå§‹åŒ–ï¼Œåœ¨`Values()`ä¸­ç»™å­—æ®µèµ‹å€¼;
* æ–¹æ³•å…ˆç”¨`Dot("æ–¹æ³•å")`æ‰¾åˆ°æ–¹æ³•ï¼Œç„¶å`Call()`è°ƒç”¨ã€‚

æœ€åçš„ç¨‹åºï¼š

```golang
func main() {
  f := NewFile("main")

  f.Type().Id("User").Struct(
    Id("Name").String(),
    Id("Age").Int(),
  )

  f.Func().Params(Id("u").Id("*User")).Id("Greeting").Params().Block(
    Qual("fmt", "Printf").Call(Lit("Hello %s"), Id("u").Dot("Name")),
  )

  f.Func().Id("main").Params().Block(
    Id("u").Op(":=").Id("User").Values(
      Id("Name").Op(":").Lit("dj"),
      Id("Age").Op(":").Lit(18),
    ),
    Id("u").Dot("Greeting").Call(),
  )

  fmt.Printf("%#v\n", f)
}
```

## å¹¶å‘æ”¯æŒ

è¿˜æ˜¯ä¸€æ ·ï¼Œå‡è®¾æˆ‘æƒ³ç”Ÿæˆä¸‹é¢çš„ç¨‹åºï¼š

```golang
package main

import "fmt"

func generate() chan int {
  out := make(chan int)
  go func() {
    for i := 1; i <= 100; i++ {
      out <- i
    }
    close(out)
  }()

  return out
}

func double(in <-chan int) chan int {
  out := make(chan int)

  go func() {
    for i := range in {
      out <- i * 2
    }
    close(out)
  }()

  return out
}

func main() {
  for i := range double(generate()) {
    fmt.Println(i)
  }
}
```

éœ€è¦ç”¨åˆ°çš„æ–°å‡½æ•°ï¼š

* é¦–å…ˆæ˜¯`make`ä¸€ä¸ª`chan`ï¼Œç”¨`Make(Chan().Int())`ï¼›
* ç„¶åå¯åŠ¨ä¸€ä¸ª goroutineï¼Œç”¨`Go()`ï¼›
* å…³é—­`chan`ï¼Œç”¨`Close()`ï¼›
* `for ... range`å¯¹åº”ä½¿ç”¨`Range()`ã€‚

æ‹¼åœ¨ä¸€èµ·å°±æ˜¯è¿™æ ·ï¼š

```golang
func main() {
  f := NewFile("main")
  f.Func().Id("generate").Params().Chan().Int().Block(
    Id("out").Op(":=").Make(Chan().Int()),
    Go().Func().Params().Block(
      For(
        Id("i").Op(":=").Lit(1),
        Id("i").Op("<=").Lit(100),
        Id("i").Op("++"),
      ).Block(Id("out").Op("<-").Id("i")),
      Close(Id("out")),
    ).Call(),
    Return().Id("out"),
  )

  f.Func().Id("double").Params(Id("in").Op("<-").Chan().Int()).Chan().Int().Block(
    Id("out").Op(":=").Make(Chan().Int()),
    Go().Func().Params().Block(
      For().Id("i").Op(":=").Range().Id("in").Block(Id("out").Op("<-").Id("i").Op("*").Lit(2)),
      Close(Id("out")),
    ).Call(),
    Return().Id("out"),
  )

  f.Func().Id("main").Params().Block(
    For(
      Id("i").Op(":=").Range().Id("double").Call(Id("generate").Call()),
    ).Block(
      Qual("fmt", "Println").Call(Id("i")),
    ),
  )

  fmt.Printf("%#v\n", f)
}
```

## ä¿å­˜ä»£ç 

ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ç”Ÿæˆä»£ç åç›´æ¥è¾“å‡ºäº†ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè‚¯å®šæ˜¯éœ€è¦ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åç¼–è¯‘è¿è¡Œçš„ã€‚`jennifer`ä¹Ÿæä¾›äº†ä¿å­˜åˆ°æ–‡ä»¶çš„æ–¹æ³•`File.Save()`ï¼Œç›´æ¥ä¼ å…¥æ–‡ä»¶åå³å¯ï¼Œè¿™ä¸ª`File`å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è°ƒç”¨`NewFile()`ç”Ÿæˆçš„å¯¹è±¡ï¼š

```golang
func main() {
  f := NewFile("main")
  f.Func().Id("main").Params().Block(
    Qual("fmt", "Println").Call(Lit("Hello, world")),
  )

  _, err := os.Stat("./generated")
  if os.IsNotExist(err) {
    os.Mkdir("./generated", 0666)
  }

  err = f.Save("./generated/main.go")
  if err != nil {
    log.Fatal(err)
  }
}

```

è¿™ç§æ–¹å¼å¿…é¡»è¦ä¿è¯`generated`ç›®å½•å­˜åœ¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨`os`åº“åœ¨ç›®å½•ä¸å­˜åœ¨æ—¶åˆ›å»ºä¸€ä¸ªã€‚

## å¸¸è§é—®é¢˜

`jennifer`åœ¨ç”Ÿæˆä»£ç åä¼šè°ƒç”¨`go fmt`å¯¹ä»£ç è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¦‚æœä»£ç å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œè¿™æ—¶å€™ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚æˆ‘é‡åˆ°æœ€å¤šçš„é—®é¢˜å°±æ˜¯æœ€åç”Ÿæˆçš„ç¨‹åºä»£ç ä»¥`})`ç»“å°¾ï¼Œè¿™æ˜æ˜¾ä¸ç¬¦åˆè¯­æ³•ã€‚æŸ¥äº†åŠå¤©å‘ç°`Func()`åå¿˜è®°åŠ `Params()`ã€‚å³ä½¿æ˜¯ç©ºå‚æ•°ï¼Œè¿™ä¸ª`Params()`ä¹Ÿä¸èƒ½çœç•¥ï¼

## æ€»ç»“

`jennifer`æ”¯æŒçš„è¿œä¸æ­¢æˆ‘ä¸Šé¢ä»‹ç»çš„é‚£äº›ï¼Œå®é™…ä¸Š Go çš„è¯­æ³•å’Œç‰¹æ€§å®ƒéƒ½æ”¯æŒï¼Œå¦‚`select/goto/panic/recover/continue/break`ï¼Œè¿˜æœ‰ç±»å‹æ–­è¨€`b, ok := i.(bool)`ã€æ³¨é‡Šã€cgo ç­‰ç­‰ç­‰ç­‰ã€‚æ„Ÿå…´è¶£å¯ä»¥è‡ªå·±å»æ¢ç´¢ã€‚è™½ç„¶`jennifer`å‡½æ•°ä¼—å¤šï¼Œä½†æ˜¯æŒ‰ç…§æˆ‘ä»¬çš„**é€å­—ç¿»è¯‘**å¤§æ³•ï¼Œå®é™…ä¸Šç”¨èµ·æ¥å¾ˆç®€å•ã€‚è¯´å®è¯ï¼Œæˆ‘åœ¨å†™ä¸Šæ¬¡çš„æµ‹è¯•ç¨‹åºæ—¶ï¼ŒåŸºæœ¬ä¸Šæ²¡çœ‹æ–‡æ¡£ï¼Œå…ˆæŒ‰ç…§è‡ªå·±çš„ç†è§£å»å†™ï¼Œç»“æœå¤§éƒ¨åˆ†éƒ½æ˜¯å¯¹ï¼åªæœ‰ä¸€äº›æœ‰é—®é¢˜çš„åœ°æ–¹å†å»çœ‹æ–‡æ¡£ã€‚

è¯´äº†è¿™ä¹ˆå¤šï¼Œ`jennifer`çš„ç”¨é€”æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç­”æ›°ï¼Œæ ¹æ®é…ç½®ç”Ÿæˆä»£ç ï¼Œç¼–å†™ç”Ÿæˆä»£ç çš„å·¥å…·ã€‚å¦å¤–`jennifer`çš„ GitHub ä¸­æœ‰ä¸€ä¸ª`genjen`ç›®å½•ï¼Œå®é™…ä¸Šæˆ‘ä»¬ç”¨åˆ°çš„å¾ˆå¤šå‡½æ•°éƒ½æ˜¯é€šè¿‡å®ƒæ¥ç”Ÿæˆçš„ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ£’ğŸ˜„ã€‚

å¤§å®¶å¦‚æœå‘ç°å¥½ç©ã€å¥½ç”¨çš„ Go è¯­è¨€åº“ï¼Œæ¬¢è¿åˆ° Go æ¯æ—¥ä¸€åº“ GitHub ä¸Šæäº¤ issueğŸ˜„

## å‚è€ƒ

1. jennifer GitHubï¼š[https://github.com/dave/jennifer](https://github.com/dave/jennifer)
2. Go æ¯æ—¥ä¸€åº“ GitHubï¼š[https://github.com/darjun/go-daily-lib](https://github.com/darjun/go-daily-lib)

## æˆ‘

[æˆ‘çš„åšå®¢](https://darjun.github.io)

æ¬¢è¿å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ã€GoUpUpã€‘ï¼Œå…±åŒå­¦ä¹ ï¼Œä¸€èµ·è¿›æ­¥~

![](/img/wxgzh8.jpg#center)